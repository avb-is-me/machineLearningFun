name: Extract Contents

on: [push]

jobs:
  extract_contents:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: bash -c "echo > extracted.md"
    - run: git diff --name-only HEAD HEAD~1 | grep 'dev-docs/' | xargs -I {} bash -c "echo -e '\n--- {} ---\n' >> extracted.md; cat {} >> extracted.md; echo '-----' >> extracted.md"
    - run: git config --global user.email "andrew@dev-docs.io"
    - run: git config --global user.name "avb-is-me"
    - run: |
        curl --location --request POST '${{ secrets.URL }}' \
        --header "X-API-KEY: ${{ secrets.TEST }}" \
              --header 'Content-Type: text/plain' \
              --data-raw "$(cat extracted.md)"
    - run: git add extracted.md
    - run: git commit -m "Extract contents from dev-docs folder"
    - run: git push
